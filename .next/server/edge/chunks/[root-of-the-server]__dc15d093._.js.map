{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse, NextRequest } from 'next/server';\nimport { jwtVerify } from 'jose';\n\nconst SECRET_KEY = process.env.JWT_SECRET_KEY;\n\nif (!SECRET_KEY) {\n  throw new Error('JWT_SECRET_KEY is not defined in environment variables');\n}\n\nconst secretKeyUint8 = new TextEncoder().encode(SECRET_KEY);\n\nexport async function middleware(request: NextRequest) {\n  const sessionToken = request.cookies.get('session_token')?.value;\n  const { pathname } = request.nextUrl;\n\n  // Allow requests to the login page to pass through\n  if (pathname === '/admin/login') {\n    return NextResponse.next();\n  }\n\n  if (!sessionToken) {\n    // If no token, redirect to the login page\n    return NextResponse.redirect(new URL('/admin/login', request.url));\n  }\n\n  try {\n    // Verify the token\n    await jwtVerify(sessionToken, secretKeyUint8);\n    // If token is valid, proceed to the requested page\n    return NextResponse.next();\n  } catch (error) {\n    // If token is invalid (or expired), redirect to the login page\n    console.error('JWT Verification Error:', error);\n    const response = NextResponse.redirect(new URL('/admin/login', request.url));\n    // Clear the invalid cookie\n    response.cookies.set('session_token', '', { maxAge: -1 });\n    return response;\n  }\n}\n\n// Define the paths that the middleware should apply to\nexport const config = {\n  matcher: '/admin/:path*',\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,cAAc;AAE7C,IAAI,CAAC,YAAY;IACf,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,iBAAiB,IAAI,cAAc,MAAM,CAAC;AAEzC,eAAe,WAAW,OAAoB;IACnD,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;IAC3D,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,mDAAmD;IACnD,IAAI,aAAa,gBAAgB;QAC/B,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,CAAC,cAAc;QACjB,0CAA0C;QAC1C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;IAClE;IAEA,IAAI;QACF,mBAAmB;QACnB,MAAM,CAAA,GAAA,+JAAA,CAAA,YAAS,AAAD,EAAE,cAAc;QAC9B,mDAAmD;QACnD,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,+DAA+D;QAC/D,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAC1E,2BAA2B;QAC3B,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI;YAAE,QAAQ,CAAC;QAAE;QACvD,OAAO;IACT;AACF;AAGO,MAAM,SAAS;IACpB,SAAS;AACX"}}]
}